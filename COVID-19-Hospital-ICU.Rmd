---
title: "Hospitalization and ICU for COVID-19 in Italian Regions"
date: "`r format(Sys.time(), '%d %b %Y')`"
output: 
  rmarkdown::html_vignette:
    toc: true
    number_sections: false
    css: "COVID-19-IT.css"
---

<br><br>


```{r setup, echo=FALSE}
source("setup.R")
```

# Data 

Dipartimento della Protezione Civile: COVID-19 Italia - Monitoraggio della situazione http://arcg.is/C1unv

Source: https://github.com/pcm-dpc/COVID-19 

```{R}
url = "https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv"
COVID19 <- read.csv(file = url, stringsAsFactors = FALSE)
COVID19$data <- as.Date(COVID19$data)
cnames <- colnames(COVID19)
cnames[which(cnames == "data")] <- "date"
colnames(COVID19) <- cnames
Region <- unique(COVID19$denominazione_regione)
# DT::datatable(COVID19)
```

```{R}
require(dplyr)
data <- COVID19 %>% 
  group_by(denominazione_regione) %>% 
  mutate(hosp = c(NA, diff(totale_ospedalizzati))) %>%
  mutate(icu = c(NA, diff(terapia_intensiva)))
data = subset(data, totale_casi > 50)
data$denominazione_regione <- factor(data$denominazione_regione,
                                     levels = c(
"Valle d'Aosta", "Piemonte", "Liguria", "Lombardia", "Veneto", "P.A. Trento", "P.A. Bolzano", "Friuli Venezia Giulia", 
"Emilia-Romagna", "Toscana", "Umbria", "Marche", "Lazio", 
"Abruzzo", "Molise", "Campania", "Basilicata", "Puglia", "Calabria", 
"Sicilia", "Sardegna"))
# View(data)
```

```{R}
ggplot(data, aes(x = date, y = hosp, 
                    group = denominazione_regione,
                    colour = denominazione_regione)) + 
  geom_point(col = 1) +
  geom_smooth(method = "loess", se = FALSE, col = palette()[4]) +
  facet_wrap(~ denominazione_regione, scales = "free_y",
             nrow = 6, ncol = 4) +
  geom_hline(yintercept = 0, lty = 2) +
  labs(x = "", y = "Change hospitalized patients") +
  # coord_cartesian(ylim = range(df$hospital, na.rm = TRUE)) +
  scale_y_continuous(breaks = scales::pretty_breaks()) +
  scale_x_date(date_breaks = "1 week", date_labels =  "%b%d") +
  theme_bw() +
  theme(legend.position = "none",
        axis.text.x = element_text(angle=60, hjust=1))
```

```{R}
ggplot(data, aes(x = date, y = icu, 
                    group = denominazione_regione,
                    colour = denominazione_regione)) + 
  geom_point(col = 1) +
  geom_smooth(method = "loess", se = FALSE, col = palette()[4]) +
  facet_wrap(~ denominazione_regione, scales = "free_y",
             nrow = 6, ncol = 4) +
  geom_hline(yintercept = 0, lty = 2) +
  labs(x = "", y = "Change ICU") +
  # coord_cartesian(ylim = range(df$hospital, na.rm = TRUE)) +
  scale_y_continuous(breaks = scales::pretty_breaks()) +
  scale_x_date(date_breaks = "1 week", date_labels =  "%b%d") +
  theme_bw() +
  theme(legend.position = "none",
        axis.text.x = element_text(angle=60, hjust=1))
```
